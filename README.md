# üîî –°–∏—Å—Ç–µ–º–∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Notification System)
–ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ multiple –∫–∞–Ω–∞–ª–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º.

# üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
üìß Email - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ SMTP

üì± SMS - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Twilio

üì≤ Telegram - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fallback - –µ—Å–ª–∏ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π

‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ - —á–µ—Ä–µ–∑ Celery –∏ Redis

üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

# üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
Python 3.9+

Django 4.2+

Celery - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

Redis - –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

Twilio - SMS —Ä–∞—Å—Å—ã–ª–∫–∏

Telegram Bot API - –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

``` git clone <repository-url>
cd notification_task
poetry install
```

2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

    –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
    - –ü—Ä–∏–º–µ—Ä .env –ª–µ–∂–∏—Ç –∫ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (env)


3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
python manage.py migrate
python manage.py createsuperuser
```

4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
    - –¢–µ—Ä–º–∏–Ω–∞–ª 1 - Redis:
    ```
    redis-server
    ```
    - –¢–µ—Ä–º–∏–Ω–∞–ª 2 - Celery Worker:
    ```
    celery -A notification_task worker --loglevel=info --pool=solo

    ```
    - –¢–µ—Ä–º–∏–Ω–∞–ª 3 - Django Server:
    ```
    python manage.py runserver
    ```


# üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
## –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```
    from notifications.tasks import send_notification_task

    # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    send_notification_task.delay(
    user_id=1,
    subject="–í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ", 
    message="–¢–µ–∫—Å—Ç –≤–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"
    )
```
## –ß–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å –Ω–∞–ø—Ä—è–º—É—é
```
from django.contrib.auth.models import User
from notifications.service import NotificationService

user = User.objects.get(id=1)
service = NotificationService(
    user=user,
    subject="–¢–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è",
    message="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
)

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å fallback
success = service.send()

# –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
report = service.get_delivery_report()
print(f"–£—Å–ø–µ—à–Ω–æ: {report['success']}")
print(f"–ö–∞–Ω–∞–ª: {report['successful_channel']}")
print(f"–ù–µ—É–¥–∞—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã: {report['failed_channels']}")
```

# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–æ–≤

## Email
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django SMTP. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ .env –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω—ã:

- EMAIL_HOST, EMAIL_PORT

- EMAIL_HOST_USER, EMAIL_HOST_PASSWORD

- –î–ª—è Gmail –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ App Password

## Telegram
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather

2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

3. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à Chat ID —á–µ—Ä–µ–∑ @userinfobot

4. –î–æ–±–∞–≤—å—Ç–µ Chat ID –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

``` 
from notifications.models import UserProfile

profile = UserProfile.objects.get(user=user)
profile.telegram_chat_id = "–≤–∞—à_chat_id"
profile.save()
```

## SMS (Twilio)
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ Twilio

2. –ü–æ–ª—É—á–∏—Ç–µ Account SID –∏ Auth Token

3. –ö—É–ø–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ Twilio

4. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
profile.phone_number = "+79123456789"  # –≤ —Ñ–æ—Ä–º–∞—Ç–µ E.164
profile.save()
```

# üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–∞–Ω–∞–ª–æ–≤

–°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. Telegram ü•á (–±—ã—Å—Ç—Ä—ã–π, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)

2. Email ü•à (–Ω–∞–¥–µ–∂–Ω—ã–π)

3. SMS ü•â (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞)

–ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π.

# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```
# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞
python test_fallback.py
```

## –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

```
from notifications.service import NotificationService

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = User.objects.create_user(
    username='test_user',
    email='test@example.com',
    password='testpass123'
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
profile = UserProfile.objects.create(
    user=user,
    phone_number='+79123456789',
    telegram_chat_id='123456789'
)

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
service = NotificationService(
    user=user,
    subject="–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
    message="–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã"
)
service.send()
```

# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```
from notifications.models import Notification

# –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
notifications = Notification.objects.all()

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
sent_count = Notification.objects.filter(status='sent').count()
failed_count = Notification.objects.filter(status='failed').count()
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏. –õ–æ–≥–∏ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤:

–ö–æ–Ω—Å–æ–ª–∏ Celery worker

–§–∞–π–ª–µ test_results.log (–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤)



# üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

## Email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP –≤ .env

- –î–ª—è Gmail –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ App Password, –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç email

## Telegram –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Chat ID

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

## SMS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å Twilio –∞–∫–∫–∞—É–Ω—Ç–∞

- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–æ–º–µ—Ä–∞ (+79123456789)

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SID –∏ —Ç–æ–∫–µ–Ω Twilio

## Celery –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Celery worker –∑–∞–ø—É—â–µ–Ω

- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Celery –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
